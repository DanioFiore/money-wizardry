; =============================================================================
; LARAVEL OCTANE PHP OPTIMIZATION CONFIGURATION - CLOUD RUN OPTIMIZED
; =============================================================================

; Memory Management (optimized for Cloud Run limits)
memory_limit = 512M
max_execution_time = 30

; OPcache Configuration for Cloud Run (optimized for faster startup)
opcache.enable = 1
opcache.enable_cli = 1
opcache.memory_consumption = 128
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 10000
opcache.validate_timestamps = 0
opcache.save_comments = 0
opcache.enable_file_override = 1
opcache.optimization_level = 0x7FFFFFFF
; Fast shutdown for better Cloud Run performance
opcache.fast_shutdown = 1
; Enable JIT for PHP 8+ performance boost
opcache.jit_buffer_size = 64M
opcache.jit = 1255
; OPcache preload disabled for Laravel Octane compatibility
; opcache.preload = /app/config/opcache-preload.php

; Realpath Cache Optimization (reduced for Cloud Run)
realpath_cache_size = 2M
realpath_cache_ttl = 1800

; File Upload Limits (reduced for Cloud Run)
upload_max_filesize = 32M
post_max_size = 32M
max_file_uploads = 10

; Session Configuration (disabled for Octane)
session.auto_start = 0

; Error Handling for Production
display_errors = 0
display_startup_errors = 0
log_errors = 1
error_log = /proc/self/fd/2

; Security Settings
expose_php = 0
allow_url_fopen = 0
allow_url_include = 0

; Performance Settings (optimized for Cloud Run)
max_input_vars = 5000
default_socket_timeout = 5

; Cloud Run Specific Optimizations
; Disable unnecessary features for serverless
auto_detect_line_endings = 0
implicit_flush = 0

; Database Connection Timeout Settings (aggressive for Cloud Run)
mysql.connect_timeout = 3
mysqli.default_socket_timeout = 3

; Additional Cloud Run optimizations
; Reduce garbage collection frequency for better performance
zend.enable_gc = 1
opcache.enable_file_override = 1

; Process control optimizations
pcre.jit = 1
pcre.recursion_limit = 10000

; =============================================================================
; CLOUD RUN SPECIFIC OPTIMIZATIONS
; =============================================================================

; Optimize for serverless cold starts
; Reduce memory footprint for faster initialization
max_input_time = 30
max_input_nesting_level = 64

; Optimize output buffering for Cloud Run
output_buffering = 4096
implicit_flush = 0

; Optimize for HTTP/2 and multiplexing
fastcgi.logging = 0

; Security optimizations for Cloud Run environment
mail.add_x_header = 0
sql.safe_mode = 0

; Disable unused modules for faster startup
; These can be commented out if needed
;extension_dir = "/usr/local/lib/php/extensions/no-debug-non-zts-20220829"
;enable_dl = 0

; FrankenPHP specific optimizations
; These work well with Cloud Run
user_ini.filename = ""
user_ini.cache_ttl = 0
